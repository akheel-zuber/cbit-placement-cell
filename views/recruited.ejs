<%- include("partials/header") -%>

  <title>Placement Recruiters</title>

  <!-- <link rel="stylesheet" href="styling/style.css"> -->

  <link rel="stylesheet" href="styling/home.css" />

  <link rel="stylesheet" href="styling/plc3.css">

  </head>


  <body>

    <!-- ----------------   NAVBAR STARTS ------------------------------- -->

    <%- include("partials/navbar") -%>


      <!--     <button id="sidebar-toggle" style="position: fixed; z-index: 1100; top: 20px; left: 20px;">Toggle Sidebar</button>

 -->

      <!-- Sidebar HTML -->

      <div class="sidebar">


        <button id="close-sidebar" type="button"
          style="position: absolute; background-color: rgb(191, 216, 255); border: none; right: 10px; top: 10px; border-radius: 20rem; padding: 10px;"
          class="btn btn-primary"><svg fill="#000000" width="25px" height="25px" viewBox="0 0 32 32"
            xmlns="http://www.w3.org/2000/svg">

            <path
              d="M18.8,16l5.5-5.5c0.8-0.8,0.8-2,0-2.8l0,0C24,7.3,23.5,7,23,7c-0.5,0-1,0.2-1.4,0.6L16,13.2l-5.5-5.5  c-0.8-0.8-2.1-0.8-2.8,0C7.3,8,7,8.5,7,9.1s0.2,1,0.6,1.4l5.5,5.5l-5.5,5.5C7.3,21.9,7,22.4,7,23c0,0.5,0.2,1,0.6,1.4  C8,24.8,8.5,25,9,25c0.5,0,1-0.2,1.4-0.6l5.5-5.5l5.5,5.5c0.8,0.8,2.1,0.8,2.8,0c0.8-0.8,0.8-2.1,0-2.8L18.8,16z" />

          </svg></button>

        <br><br>

        <form action="">

          <label for="year-slider" class="form-label"><strong>Select Year:</strong></label><br>

          <input type="range" id="year-slider" class="form-range form_range" min="2000" max="2024" value="2020" step="1"
            oninput="updateYearDisplay(this.value)">

          <p><strong>Year Selected: </strong><span id="selected-year"><strong>2020</strong></span></p>
          <input type="checkbox" name="selectyear" value="selectyearyes"> <strong>&nbsp;Apply This Filter</strong> <br><br>

          <hr>

          <label for="autocomplete-company"><strong>Type to search a company:</strong></label><br><br>

          <input class="form-control form-control_s" list="companies" id="autocomplete-company" name="company"
            placeholder="Start typing..." autocomplete="off">

          <datalist id="companies">

            <option value="Google"></option>




          </datalist><br>

          <div id="checkbox-container"></div>
          <input type="checkbox" name="selectcompany" value="selectcompanyyes"> <strong>&nbsp;Apply This Filter</strong> <br><br>

          <hr>

          <div>
            <label for="section"><strong>Choose sections</strong></label><br><br>
            <input type="checkbox" name="section" value="cse-1"> <strong>&nbsp;&nbsp;CSE-1</strong> <br><br>
            <input type="checkbox" name="section" value="cse-2"> <strong>&nbsp;&nbsp;CSE-2</strong> <br><br>
            <input type="checkbox" name="section" value="cse-3"> <strong>&nbsp;&nbsp;CSE-3</strong> <br><br>
        </div>
        
          <button type="button" class="filter_company btn cbtn btn-primary">Submit</button>
        </form>
        <div style="height: 150px;"></div>
      </div>


      <!-- Sidebar HTML ends -->


      <!-- search club -->



      <div id="all_other_than_sidebar" style="margin-top: 5rem;">
        <div style="display: flex; align-items: center; justify-content: center;">
          <div style="display: flex;">
            <button id="sidebar-toggle" type="button" class="btn btn-primary cbtn">
              <div style="display: flex;align-items: center;"><i class="fa-solid fa-filter"></i>&nbsp;&nbsp;Filter
              </div>
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a href="/add_rec"><button class="btn btn-primary cbtn">Add Recruitment</button></a>
          </div>
        </div>
      </div>
      <div class="container-fluid" style="margin-bottom: 15px; margin-top: 3rem;">
        <div class="row">
          <div class="col-md-11 col-12 mx-auto">
            <div class="row" id="recruited_students">
              <div class="col-md-3 col-12">
                <div class="card card_s">
                  <center>
                    <div class="card_img_div">
                      <img src="https://api.kickfire.com/logo?website=accenture.com" class="card-img-top" alt="...">
                    </div>
                  </center>
                  <div class="card-body">
                    <h4>Accenture</h4>
                    <h6><strong>Role : Web Developer</strong></h6>
                    <p>Year: <strong>2024</strong></p>
                    <p>students recruited: <strong>30</strong></p>
                    <p>Section: <strong>All</strong></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->

      <%- include("partials/footer") -%>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
          </script>

        <script>



          // SIDEBAR BULANE KE LIYE FUNCTION

          document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.querySelector('.sidebar');
            const toggleBtn = document.getElementById('sidebar-toggle');
            const closeBtn = document.getElementById('close-sidebar');
            const all_others = document.getElementById("all_other_than_sidebar")
            toggleBtn.addEventListener('click', function () {
              sidebar.classList.add('visible');
              all_others.style.filter = "blur(10px)"
            });

            closeBtn.addEventListener('click', function () {
              sidebar.classList.remove('visible');
              all_others.style.filter = "blur()"
            });
          });




          // YEAR SELECTOR AND UPDATER
          function updateYearDisplay(value) {

            document.getElementById('selected-year').innerHTML = "<strong>" + value + "</strong>";


          }



          // COMPANY KE NAMES DISPLAY KARTA SIDEBAR MEI   #SHURU

          const form = document.getElementById('company-form');
          const input = document.getElementById('autocomplete-company');
          const checkboxContainer = document.getElementById('checkbox-container');

          input.addEventListener('keydown', function (event) {
            if (event.key === "Enter" && input.value) {
              event.preventDefault();
              const inputValue = input.value;
              if (Array.from(document.querySelectorAll('#companies option')).some(option => option.value === inputValue)) {
                if (!document.querySelector(`input[name="${inputValue}"]`)) {
                  const checkbox = document.createElement('input');
                  checkbox.type = 'checkbox';
                  checkbox.me = inputValue;
                  checkbox.vaid = inputValue;
                  checkbox.nalue = inputValue;
                  checkbox.checked = true;
                  checkbox.classList.add('form-check-input');

                  const label = document.createElement('label');
                  label.htmlFor = inputValue;
                  label.textContent = inputValue;
                  label.classList.add('form-check-label');

                  const div = document.createElement('div');
                  div.classList.add('form-check');

                  div.appendChild(checkbox);
                  div.appendChild(label);
                  checkboxContainer.appendChild(div);
                }
              }
              input.value = "";
            }
          });

          // COMPANY KE NAMES DISPLAY KARTA SIDEBAR MEI  #END


          // Displaying Companies

          let students = <%- JSON.stringify(students) %>;
          const scards = document.getElementById("recruited_students");
          console.log(students)
          const uniqueCompanyNamesSet = new Set();

          students.forEach(student => {
              uniqueCompanyNamesSet.add(student.companyName);
          });

          const companyNamesArray = Array.from(uniqueCompanyNamesSet);

          console.log(companyNamesArray);


          const datal = document.getElementById("companies");

          datal.innerHTML = "";

          companyNamesArray.forEach(company => {
              const option = document.createElement("option");
              option.value = company;
              datal.appendChild(option);
          });
          function addingcards(arr) {
            scards.innerHTML = '';
            arr.forEach(element => {

              const stcard = `
              <div class="col-md-3 col-12">

                <div class="card card_s">

                  <center>

                    <div class="card_img_div">

                      <img src="https://api.kickfire.com/logo?website=${element.companyDomain}" class="card-img-top" alt="${element.companyDomain}">

                    </div>

                  </center>

                  <div class="card-body">

                    <h4>${element.companyName}</h4>
                    
                    <h6><strong>Role : ${element.role}</strong></h6>
                    <h6><strong>Type : ${element.jobType}</strong></h6>

                    <p>Year: <strong>${element.year}</strong></p>

                    <p>Section: <strong>${element.section}</strong></p>

                  </div>

                </div>

              </div>
              `

              scards.innerHTML += stcard
            })
          }



          function loadDetails() {
            addingcards(students)
          }

          loadDetails()


          // Filtering COMPANIES

          const button = document.querySelector('.filter_company');
let selectedCompanies = [];
let selectedSections = [];
let y = -1; 

const applyFilterCompany = document.querySelector('input[name="selectcompany"]');
applyFilterCompany.addEventListener('change', function() {
    if (this.checked) {
        console.log("Apply filter company checkbox is checked.");
        selectedCompanies = []; 
        document.querySelectorAll('#checkbox-container input[type="checkbox"]:checked').forEach(checkbox => {
            selectedCompanies.push(checkbox.value);
        });
    } else {
        console.log("Apply filter company checkbox is unchecked.");
        selectedCompanies = []; 
    }
});


// Event listener for year filter checkbox
const applyFilterYear = document.querySelector('input[name="selectyear"]');
applyFilterYear.addEventListener('change', function() {
    if (this.checked) {
        console.log("Apply filter year checkbox is checked.");
        y = Number(document.getElementById('year-slider').value);
      }else{
      console.log("Apply filter year checkbox is unchecked.");
      y = -1; }
});

button.addEventListener('click', function (event) {
    selectedSections = [];

    document.querySelectorAll('input[name="section"]:checked').forEach(checkbox => {
        selectedSections.push(checkbox.value);
    });

    console.log('Year:', y);
    console.log('Selected Companies:', selectedCompanies);
    console.log('Selected Sections:', selectedSections);

 // Filter students based on selections
let temp = students.filter((s) => {
    if (y === -1 || s.year === y) { 
        if (selectedCompanies.length === 0 || selectedCompanies.includes(s.companyName)) { 
            if (selectedSections.length === 0 || selectedSections.includes(s.section)) { 
                return true; 
            }
        }
    }
    return false; 
});


    console.log(temp);
    addingcards(temp);
});


        </script>



  </body>


  </html>